<!-- Sınıfların Genel Durumu -->
<div class="h-full max-h-full p-4 lg:p-6 overflow-hidden relative">
  <!-- Kapat Butonu -->
  <div class="absolute top-4 right-4 z-10">
    <button class="btn btn-ghost p-2" (click)="appState.collapseAll()" aria-label="Kapat">
      <span class="text-lg font-bold text-espresso">✕</span>
    </button>
  </div>
  
  <div class="hidden md:grid gap-3 lg:grid-cols-4 h-full">
    <!-- Sol: Sınıf Listesi -->
    <section class="flexible-content overflow-hidden">
      <div class="mt-0 flex items-center justify-between">
        <h4 class="text-lg font-semibold text-espresso">Sınıf Listesi</h4>
      </div>
      
      <!-- Loading -->
      <div *ngIf="isLoading" class="flex justify-center items-center h-[343px]">
        <div class="animate-spin rounded-full h-8 w-8 border-2 border-primary border-t-transparent"></div>
      </div>

      <!-- Error -->
      <div *ngIf="errorMessage" class="h-[343px] border border-red-200 rounded-lg bg-red-50 flex items-center justify-center text-red-600 text-sm">
        {{ errorMessage }}
      </div>

      <!-- Sınıf Listesi -->
      <div *ngIf="!isLoading && !errorMessage" class="h-[343px] overflow-auto divide-y divide-borderGray/60 border border-borderGray rounded-lg">
        <button 
          *ngFor="let sinif of siniflar" 
          class="group w-full text-left h-16 px-3 relative hover:bg-primary/10" 
          [ngClass]="{'bg-infoSurface/30': seciliSinif?.id === sinif.id}" 
          (click)="selectSinif(sinif)">
          <div class="flex items-center justify-between h-full">
            <div>
              <div class="text-[17px] font-semibold text-espresso">{{ sinif.ad }}</div>
              <div class="text-sm text-espresso/60">{{ (sinif.dersler || []).length }} ders</div>
            </div>
            <div *ngIf="seciliSinif?.id === sinif.id" class="text-primary">✔</div>
          </div>
        </button>
      </div>
    </section>
    
    <!-- Orta: Ders Listesi -->
    <section class="flexible-content hidden md:block" [class.animate-slide-in]="seciliSinif">
      <div *ngIf="!seciliSinif" class="mt-7 h-96 border-2 border-dashed border-borderGray rounded-lg grid place-items-center text-espresso/50">Sınıf seçin</div>
      <div *ngIf="seciliSinif">
        <div class="text-base font-semibold text-espresso">{{ seciliSinif.ad }} · Ders Listesi</div>
        <!-- Ders Listesi -->
        <div class="h-[342px] overflow-auto divide-y divide-borderGray/60 border border-borderGray rounded-lg mt-2">
          <div *ngIf="dersler.length === 0" class="h-full flex items-center justify-center text-espresso/50">
            Henüz ders eklenmemiş
          </div>
          <button 
            *ngFor="let ders of dersler" 
            class="w-full text-left h-12 px-3 relative hover:bg-primary/10" 
            (click)="selectDers(ders)" 
            [ngClass]="{'bg-infoSurface/30': seciliDers?.id === ders.id}">
            <div class="flex items-center justify-between h-full">
              <div class="text-[15px] font-semibold text-espresso">{{ ders.ad }}</div>
              <div *ngIf="ders.ders_adi" class="text-sm text-espresso/70">{{ ders.ders_adi }}</div>
              <div *ngIf="seciliDers?.id === ders.id" class="text-primary">✔</div>
            </div>
          </button>
        </div>
      </div>
    </section>
    
    <!-- Sağ: Sınav Listesi -->
    <section class="flexible-content hidden md:block" [class.animate-slide-in]="seciliDers">
      <div *ngIf="!seciliDers" class="mt-7 h-96 border-2 border-dashed border-borderGray rounded-lg grid place-items-center text-espresso/50">Ders seçin</div>
      <div *ngIf="seciliDers">
        <div class="text-base font-semibold text-espresso">{{ seciliDers.ad }} · Sınav Listesi</div>
        <div class="h-[342px] overflow-auto divide-y divide-borderGray/60 border border-borderGray rounded-lg mt-2">
          <div *ngIf="sinavlar.length === 0" class="h-full flex items-center justify-center text-espresso/50">
            Henüz sınav eklenmemiş
          </div>
          <button 
            *ngFor="let sinav of sinavlar" 
            class="w-full text-left h-12 px-3 relative hover:bg-primary/10" 
            (click)="selectSinav(sinav)" 
            [ngClass]="{'bg-infoSurface/30': seciliSinav?.sinav_id === sinav.sinav_id}">
            <div class="flex items-center justify-between h-full">
              <div class="text-[15px] font-semibold text-espresso">{{ sinav.ders_adi }}</div>
              <div class="text-sm text-espresso/70">{{ sinav.tarih | date:'dd/MM/yyyy' }}</div>
              <div *ngIf="seciliSinav?.sinav_id === sinav.sinav_id" class="text-primary">✔</div>
            </div>
          </button>
        </div>
      </div>
    </section>
    
    <!-- En Sağ: İstatistikler -->
    <section class="flexible-content hidden md:block" [class.animate-slide-in]="seciliSinav">
      <div *ngIf="!seciliSinav" class="mt-7 h-96 border-2 border-dashed border-borderGray rounded-lg grid place-items-center text-espresso/50">Sınav seçin</div>
      <div *ngIf="seciliSinav" class="relative mt-8">
        <!-- Başlık - Kenarlığın üzerinde -->
        <div class="absolute -top-9 left-4 z-10 bg-white px-3 py-1">
          <div class="text-base font-semibold text-espresso">{{ seciliSinif?.ad }} · {{ seciliDers?.ad }} · {{ seciliSinav.ders_adi }} Sınav Analizi</div>
        </div>

        <!-- Ana kart -->
        <div class="h-[380px] overflow-auto rounded-lg border border-borderGray bg-white">
          <!-- Loading -->
          <div *ngIf="isLoading" class="flex justify-center items-center h-full">
            <div class="animate-spin rounded-full h-8 w-8 border-2 border-primary border-t-transparent"></div>
          </div>

          <!-- Error -->
          <div *ngIf="errorMessage" class="p-4 text-center text-red-600 text-sm">
            {{ errorMessage }}
          </div>

          <!-- İstatistikler -->
          <div *ngIf="istatistikler && !isLoading" class="p-4 space-y-4">
            <!-- Ana İstatistikler -->
            <div class="grid sm:grid-cols-2 gap-4 items-center">
              <div>
                <div class="text-xs text-espresso/60 mb-1">Sınıf Ortalaması</div>
                <div class="text-2xl font-semibold text-espresso">{{ istatistikler.sinif_ortalamasi }} / 100</div>
                <div class="mt-2 h-3 w-full bg-borderGray/50 rounded-full overflow-hidden">
                  <div class="h-full bg-primary" [style.width.%]="istatistikler.sinif_ortalamasi"></div>
                </div>
              </div>
              <div>
                <div class="text-xs text-espresso/60 mb-1">Kopya İhtimali</div>
                <div class="text-xl font-semibold text-espresso">%{{ istatistikler.kopya_ihtimali }}</div>
                <div class="mt-2 h-3 w-full bg-borderGray/50 rounded-full overflow-hidden">
                  <div class="h-full rounded-full"
                       [ngStyle]="{
                         width: (istatistikler.kopya_ihtimali + '%'),
                         background: getKopyaIhtimaliColor()
                       }"></div>
                </div>
              </div>
            </div>

            <!-- Puan Aralığı Grafiği -->
            <div class="bg-gray-50 rounded-lg p-4">
              <div class="text-sm font-medium text-espresso mb-3">Sınav Puan Aralığı</div>
              
              <!-- CSS Pasta Grafiği -->
              <div class="flex items-center gap-6 mb-4">
                <div class="pie-chart-container">
                  <div class="pie-chart" [style]="getPieChartStyle()"></div>
                </div>
                
                <!-- Legend -->
                <div class="space-y-2 flex-1">
                  <div *ngFor="let aralik of getPuanAraligiData()" class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                      <span class="inline-block w-3 h-3 rounded" [style.background]="aralik.color"></span>
                      <span class="text-sm text-espresso">{{ aralik.label }}</span>
                    </div>
                    <span class="text-sm font-medium text-espresso">{{ aralik.count }} kişi</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Ek İstatistikler -->
            <div class="grid grid-cols-2 gap-3">
              <div class="bg-slate-50 p-3 rounded-lg">
                <div class="text-xs font-semibold text-espresso">Sınıf Not Ortalaması</div>
                <div class="text-lg font-bold text-espresso">{{ istatistikler.sinif_ortalamasi }}</div>
              </div>
              <div class="bg-slate-50 p-3 rounded-lg">
                <div class="text-xs font-semibold text-espresso">En Yüksek Not</div>
                <div class="text-lg font-bold text-espresso">{{ istatistikler.en_yuksek_not }}</div>
              </div>
              <div class="bg-slate-50 p-3 rounded-lg">
                <div class="text-xs font-semibold text-espresso">En Düşük Not</div>
                <div class="text-lg font-bold text-espresso">{{ istatistikler.en_dusuk_not }}</div>
              </div>
              <div class="bg-slate-50 p-3 rounded-lg">
                <div class="text-xs font-semibold text-espresso">Soru Sayısı</div>
                <div class="text-lg font-bold text-espresso">{{ istatistikler.soru_sayisi }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Mobile/Tablet: Analysis below -->
    <section class="md:hidden" [class.hidden]="!seciliSinav">
      <div *ngIf="seciliSinav" class="animate-slide-in space-y-4">
        <div class="text-base font-semibold text-espresso">{{ seciliSinif?.ad }} · {{ seciliDers?.ad }} · {{ seciliSinav.ders_adi }} Sınav Analizi</div>
        
        <!-- Loading -->
        <div *ngIf="isLoading" class="flex justify-center items-center py-8">
          <div class="animate-spin rounded-full h-8 w-8 border-2 border-primary border-t-transparent"></div>
        </div>

        <!-- Error -->
        <div *ngIf="errorMessage" class="bg-red-50 border border-red-200 rounded-lg p-4 text-center text-red-600 text-sm">
          {{ errorMessage }}
        </div>
        
        <!-- İstatistikler -->
        <div *ngIf="istatistikler && !isLoading" class="space-y-4">
          <!-- Ana İstatistikler -->
          <div class="bg-white border border-borderGray rounded-lg p-4">
            <div class="grid sm:grid-cols-2 gap-4 items-center">
              <div>
                <div class="text-xs text-espresso/60 mb-1">Sınıf Ortalaması</div>
                <div class="text-3xl font-semibold text-espresso">{{ istatistikler.sinif_ortalamasi }} / 100</div>
                <div class="mt-2 h-3 w-full bg-borderGray/50 rounded-full overflow-hidden">
                  <div class="h-full bg-primary" [style.width.%]="istatistikler.sinif_ortalamasi"></div>
                </div>
              </div>
              <div>
                <div class="text-xs text-espresso/60 mb-1">Kopya İhtimali</div>
                <div class="text-2xl font-semibold text-espresso">%{{ istatistikler.kopya_ihtimali }}</div>
                <div class="mt-2 h-3 w-full bg-borderGray/50 rounded-full overflow-hidden">
                  <div class="h-full rounded-full" 
                       [ngStyle]="{ 
                         width: (istatistikler.kopya_ihtimali + '%'), 
                         background: getKopyaIhtimaliColor()
                       }"></div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Puan Aralığı -->
          <div class="bg-white border border-borderGray rounded-lg p-4">
            <div class="text-sm font-medium text-espresso mb-3">Sınav Puan Aralığı</div>
            
            <!-- CSS Pasta Grafiği -->
            <div class="flex flex-col md:flex-row items-center gap-4 mb-4">
              <div class="pie-chart-container">
                <div class="pie-chart" [style]="getPieChartStyle()"></div>
              </div>
              
              <!-- Legend -->
              <div class="space-y-2 flex-1 w-full">
                <div *ngFor="let aralik of getPuanAraligiData()" class="flex items-center justify-between">
                  <div class="flex items-center gap-2">
                    <span class="inline-block w-3 h-3 rounded" [style.background]="aralik.color"></span>
                    <span class="text-sm text-espresso">{{ aralik.label }}</span>
                  </div>
                  <span class="text-sm font-medium text-espresso">{{ aralik.count }} kişi</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Ek İstatistikler -->
          <div class="grid grid-cols-2 gap-3">
            <div class="bg-slate-50 p-3 rounded-lg">
              <div class="text-xs font-semibold text-espresso">Sınıf Not Ortalaması</div>
              <div class="text-lg font-bold text-espresso">{{ istatistikler.sinif_ortalamasi }}</div>
            </div>
            <div class="bg-slate-50 p-3 rounded-lg">
              <div class="text-xs font-semibold text-espresso">En Yüksek Not</div>
              <div class="text-lg font-bold text-espresso">{{ istatistikler.en_yuksek_not }}</div>
            </div>
            <div class="bg-slate-50 p-3 rounded-lg">
              <div class="text-xs font-semibold text-espresso">En Düşük Not</div>
              <div class="text-lg font-bold text-espresso">{{ istatistikler.en_dusuk_not }}</div>
            </div>
            <div class="bg-slate-50 p-3 rounded-lg">
              <div class="text-xs font-semibold text-espresso">Soru Sayısı</div>
              <div class="text-lg font-bold text-espresso">{{ istatistikler.soru_sayisi }}</div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>
